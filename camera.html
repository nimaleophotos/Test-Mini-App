<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LENS Camera</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            overflow: hidden;
        }
        
        .camera-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #000;
        }
        
        .camera-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }
        
        .camera-overlay > * {
            pointer-events: auto;
        }
        
        .shutter-button {
            width: 80px;
            height: 80px;
            border: 4px solid white;
            border-radius: 50%;
            background: #3b82f6;
            position: relative;
            transition: all 0.2s ease;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .shutter-button:active {
            transform: scale(0.95);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.6);
        }
        
        .shutter-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .shutter-button:active::after {
            width: 50px;
            height: 50px;
        }
        
        .control-button {
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .control-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .control-button.active {
            background: rgba(59, 130, 246, 0.8);
            border-color: #3b82f6;
        }
        
        .zoom-button {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .zoom-button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #000;
            transform: scale(1.1);
        }
        
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .grid-overlay.active {
            opacity: 0.5;
        }
        
        .grid-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .grid-3x3 .grid-line:nth-child(1) { top: 33.33%; left: 0; right: 0; height: 1px; }
        .grid-3x3 .grid-line:nth-child(2) { top: 66.66%; left: 0; right: 0; height: 1px; }
        .grid-3x3 .grid-line:nth-child(3) { left: 33.33%; top: 0; bottom: 0; width: 1px; }
        .grid-3x3 .grid-line:nth-child(4) { left: 66.66%; top: 0; bottom: 0; width: 1px; }
        
        .settings-panel {
            position: absolute;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            transition: right 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }
        
        .settings-panel.active {
            right: 0;
        }
        
        .aspect-ratio-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .aspect-ratio-overlay.active {
            opacity: 1;
        }
        
        .timer-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .timer-indicator.active {
            opacity: 1;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }
        
        .flash-effect {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            opacity: 0;
            pointer-events: none;
        }
        
        .flash-effect.active {
            animation: flash 0.3s ease;
        }
        
        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 0; }
        }
        
        .gallery-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: #333;
            overflow: hidden;
        }
        
        .gallery-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .mode-selector {
            display: flex;
            gap: 20px;
            padding: 0 20px;
        }
        
        .mode-button {
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 0;
            position: relative;
        }
        
        .mode-button.active {
            color: white;
        }
        
        .mode-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #3b82f6;
            border-radius: 1px;
        }
    </style>
</head>
<body>
    <div class="camera-container">
        <!-- Camera Preview -->
        <video class="camera-preview" id="cameraPreview" autoplay muted playsinline></video>
        
        <!-- Grid Overlay -->
        <div class="grid-overlay grid-3x3" id="gridOverlay">
            <div class="grid-line"></div>
            <div class="grid-line"></div>
            <div class="grid-line"></div>
            <div class="grid-line"></div>
        </div>
        
        <!-- Aspect Ratio Overlay -->
        <div class="aspect-ratio-overlay" id="aspectRatioOverlay"></div>
        
        <!-- Timer Indicator -->
        <div class="timer-indicator" id="timerIndicator">3</div>
        
        <!-- Flash Effect -->
        <div class="flash-effect" id="flashEffect"></div>
        
        <!-- Camera Overlay -->
        <div class="camera-overlay">
            <!-- Top Controls -->
            <div class="absolute top-0 left-0 right-0 p-4 flex justify-between items-start">
                <!-- Left Top Controls -->
                <div class="flex flex-col gap-3">
                    <button class="control-button" onclick="goBack()" title="Back">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <button class="control-button" id="flashBtn" onclick="toggleFlash()" title="Flash">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </button>
                    <button class="control-button" id="timerBtn" onclick="toggleTimer()" title="Timer">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Right Top Controls -->
                <div class="flex flex-col gap-3">
                    <button class="control-button" onclick="toggleSettings()" title="Settings">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </button>
                    <button class="control-button" id="gridBtn" onclick="toggleGrid()" title="Grid">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Zoom Controls -->
            <div class="absolute top-1/2 left-4 transform -translate-y-1/2">
                <div class="flex flex-col gap-2">
                    <button class="zoom-button active" onclick="setZoom(0.5)">0.5x</button>
                    <button class="zoom-button" onclick="setZoom(1)">1x</button>
                    <button class="zoom-button" onclick="setZoom(2)">2x</button>
                </div>
            </div>
            
            <!-- Camera Modes -->
            <div class="absolute bottom-32 left-0 right-0">
                <div class="mode-selector justify-center">
                    <button class="mode-button" onclick="setMode('video')">VIDEO</button>
                    <button class="mode-button active" onclick="setMode('photo')">PHOTO</button>
                    <button class="mode-button" onclick="setMode('portrait')">PORTRAIT</button>
                </div>
            </div>
            
            <!-- Bottom Controls -->
            <div class="absolute bottom-0 left-0 right-0 p-6">
                <div class="flex items-center justify-between">
                    <!-- Gallery Button -->
                    <button class="gallery-thumbnail" onclick="openGallery()" title="Gallery">
                        <div class="w-full h-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                    </button>
                    
                    <!-- Shutter Button -->
                    <button class="shutter-button" onclick="takePhoto()" title="Take Photo"></button>
                    
                    <!-- Switch Camera Button -->
                    <button class="control-button" onclick="switchCamera()" title="Switch Camera">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-white text-lg font-semibold">Camera Settings</h3>
                <button onclick="toggleSettings()" class="text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Aspect Ratio -->
            <div class="mb-6">
                <h4 class="text-white text-sm font-medium mb-3">Aspect Ratio</h4>
                <div class="grid grid-cols-2 gap-2">
                    <button class="aspect-btn bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setAspectRatio('full')">Full</button>
                    <button class="aspect-btn bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setAspectRatio('4:3')">4:3</button>
                    <button class="aspect-btn bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setAspectRatio('16:9')">16:9</button>
                    <button class="aspect-btn bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setAspectRatio('1:1')">1:1</button>
                </div>
            </div>
            
            <!-- Grid Options -->
            <div class="mb-6">
                <h4 class="text-white text-sm font-medium mb-3">Grid Lines</h4>
                <div class="space-y-2">
                    <button class="grid-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setGridType('none')">None</button>
                    <button class="grid-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setGridType('3x3')">Rule of Thirds</button>
                    <button class="grid-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setGridType('golden')">Golden Ratio</button>
                    <button class="grid-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setGridType('center')">Center Lines</button>
                </div>
            </div>
            
            <!-- Timer Options -->
            <div class="mb-6">
                <h4 class="text-white text-sm font-medium mb-3">Timer</h4>
                <div class="grid grid-cols-3 gap-2">
                    <button class="timer-option bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setTimerDuration(3)">3s</button>
                    <button class="timer-option bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setTimerDuration(5)">5s</button>
                    <button class="timer-option bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors" onclick="setTimerDuration(10)">10s</button>
                </div>
            </div>
            
            <!-- Flash Options -->
            <div class="mb-6">
                <h4 class="text-white text-sm font-medium mb-3">Flash</h4>
                <div class="space-y-2">
                    <button class="flash-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setFlashMode('off')">Off</button>
                    <button class="flash-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setFlashMode('on')">On</button>
                    <button class="flash-option w-full bg-gray-700 hover:bg-gray-600 text-white py-2 px-3 rounded text-sm transition-colors text-left" onclick="setFlashMode('auto')">Auto</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Camera state
        let currentStream = null;
        let currentCamera = 'user'; // 'user' for front, 'environment' for back
        let currentZoom = 1;
        let flashMode = 'off';
        let timerDuration = 0;
        let timerActive = false;
        let gridType = 'none';
        let aspectRatio = 'full';
        let currentMode = 'photo';
        let isRecording = false;
        
        // Initialize camera
        async function initCamera() {
            try {
                const constraints = {
                    video: {
                        facingMode: currentCamera,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    }
                };
                
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                document.getElementById('cameraPreview').srcObject = currentStream;
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Unable to access camera. Please check permissions.');
            }
        }
        
        // Navigation
        function goBack() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
            window.location.href = 'index.html';
        }
        
        // Camera controls
        async function switchCamera() {
            currentCamera = currentCamera === 'user' ? 'environment' : 'user';
            await initCamera();
        }
        
        function setZoom(zoom) {
            currentZoom = zoom;
            document.querySelectorAll('.zoom-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Apply zoom effect (visual feedback)
            const preview = document.getElementById('cameraPreview');
            preview.style.transform = `scale(${zoom})`;
        }
        
        // Flash controls
        function toggleFlash() {
            const modes = ['off', 'on', 'auto'];
            const currentIndex = modes.indexOf(flashMode);
            flashMode = modes[(currentIndex + 1) % modes.length];
            
            const flashBtn = document.getElementById('flashBtn');
            flashBtn.classList.toggle('active', flashMode !== 'off');
            
            updateFlashIcon();
        }
        
        function setFlashMode(mode) {
            flashMode = mode;
            const flashBtn = document.getElementById('flashBtn');
            flashBtn.classList.toggle('active', mode !== 'off');
            updateFlashIcon();
            updateSettingsButtons();
        }
        
        function updateFlashIcon() {
            const flashBtn = document.getElementById('flashBtn');
            const icon = flashBtn.querySelector('svg');
            
            if (flashMode === 'off') {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6l12 12"/>';
            } else if (flashMode === 'auto') {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/><text x="12" y="20" text-anchor="middle" font-size="8" fill="currentColor">A</text>';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>';
            }
        }
        
        // Timer controls
        function toggleTimer() {
            const durations = [0, 3, 5, 10];
            const currentIndex = durations.indexOf(timerDuration);
            timerDuration = durations[(currentIndex + 1) % durations.length];
            
            const timerBtn = document.getElementById('timerBtn');
            timerBtn.classList.toggle('active', timerDuration > 0);
            
            updateTimerIcon();
        }
        
        function setTimerDuration(duration) {
            timerDuration = duration;
            const timerBtn = document.getElementById('timerBtn');
            timerBtn.classList.toggle('active', duration > 0);
            updateTimerIcon();
            updateSettingsButtons();
        }
        
        function updateTimerIcon() {
            const timerBtn = document.getElementById('timerBtn');
            const icon = timerBtn.querySelector('svg');
            
            if (timerDuration > 0) {
                icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/><text x="12" y="16" text-anchor="middle" font-size="6" fill="currentColor">${timerDuration}</text>`;
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>';
            }
        }
        
        // Grid controls
        function toggleGrid() {
            const types = ['none', '3x3', 'golden', 'center'];
            const currentIndex = types.indexOf(gridType);
            gridType = types[(currentIndex + 1) % types.length];
            
            const gridBtn = document.getElementById('gridBtn');
            gridBtn.classList.toggle('active', gridType !== 'none');
            
            updateGrid();
        }
        
        function setGridType(type) {
            gridType = type;
            const gridBtn = document.getElementById('gridBtn');
            gridBtn.classList.toggle('active', type !== 'none');
            updateGrid();
            updateSettingsButtons();
        }
        
        function updateGrid() {
            const gridOverlay = document.getElementById('gridOverlay');
            gridOverlay.className = `grid-overlay ${gridType !== 'none' ? 'active' : ''} grid-${gridType}`;
            
            // Update grid lines based on type
            if (gridType === 'golden') {
                gridOverlay.innerHTML = `
                    <div class="grid-line" style="top: 38.2%; left: 0; right: 0; height: 1px;"></div>
                    <div class="grid-line" style="top: 61.8%; left: 0; right: 0; height: 1px;"></div>
                    <div class="grid-line" style="left: 38.2%; top: 0; bottom: 0; width: 1px;"></div>
                    <div class="grid-line" style="left: 61.8%; top: 0; bottom: 0; width: 1px;"></div>
                `;
            } else if (gridType === 'center') {
                gridOverlay.innerHTML = `
                    <div class="grid-line" style="top: 50%; left: 0; right: 0; height: 1px;"></div>
                    <div class="grid-line" style="left: 50%; top: 0; bottom: 0; width: 1px;"></div>
                `;
            } else if (gridType === '3x3') {
                gridOverlay.innerHTML = `
                    <div class="grid-line" style="top: 33.33%; left: 0; right: 0; height: 1px;"></div>
                    <div class="grid-line" style="top: 66.66%; left: 0; right: 0; height: 1px;"></div>
                    <div class="grid-line" style="left: 33.33%; top: 0; bottom: 0; width: 1px;"></div>
                    <div class="grid-line" style="left: 66.66%; top: 0; bottom: 0; width: 1px;"></div>
                `;
            }
        }
        
        // Aspect ratio controls
        function setAspectRatio(ratio) {
            aspectRatio = ratio;
            const overlay = document.getElementById('aspectRatioOverlay');
            
            overlay.classList.remove('active');
            
            setTimeout(() => {
                if (ratio === '4:3') {
                    const height = window.innerHeight * 0.75;
                    const top = (window.innerHeight - height) / 2;
                    overlay.style.top = `${top}px`;
                    overlay.style.bottom = `${top}px`;
                    overlay.style.left = '0';
                    overlay.style.right = '0';
                } else if (ratio === '16:9') {
                    const height = window.innerWidth * 9 / 16;
                    const top = (window.innerHeight - height) / 2;
                    overlay.style.top = `${top}px`;
                    overlay.style.bottom = `${window.innerHeight - top - height}px`;
                    overlay.style.left = '0';
                    overlay.style.right = '0';
                } else if (ratio === '1:1') {
                    const size = Math.min(window.innerWidth, window.innerHeight);
                    const topBottom = (window.innerHeight - size) / 2;
                    const leftRight = (window.innerWidth - size) / 2;
                    overlay.style.top = `${topBottom}px`;
                    overlay.style.bottom = `${topBottom}px`;
                    overlay.style.left = `${leftRight}px`;
                    overlay.style.right = `${leftRight}px`;
                } else {
                    overlay.style.top = '0';
                    overlay.style.bottom = '0';
                    overlay.style.left = '0';
                    overlay.style.right = '0';
                }
                
                if (ratio !== 'full') {
                    overlay.classList.add('active');
                }
            }, 50);
            
            updateSettingsButtons();
        }
        
        // Camera modes
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const shutterButton = document.querySelector('.shutter-button');
            if (mode === 'video') {
                shutterButton.style.background = '#ef4444';
                shutterButton.title = isRecording ? 'Stop Recording' : 'Start Recording';
            } else {
                shutterButton.style.background = '#3b82f6';
                shutterButton.title = 'Take Photo';
            }
        }
        
        // Settings panel
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
        }
        
        function updateSettingsButtons() {
            // Update aspect ratio buttons
            document.querySelectorAll('.aspect-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-gray-700');
            });
            
            // Update grid buttons
            document.querySelectorAll('.grid-option').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-gray-700');
            });
            
            // Update timer buttons
            document.querySelectorAll('.timer-option').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-gray-700');
            });
            
            // Update flash buttons
            document.querySelectorAll('.flash-option').forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-gray-700');
            });
        }
        
        // Photo capture
        async function takePhoto() {
            if (currentMode === 'video') {
                toggleRecording();
                return;
            }
            
            if (timerDuration > 0 && !timerActive) {
                startTimer();
                return;
            }
            
            // Flash effect
            if (flashMode === 'on' || (flashMode === 'auto' && shouldUseFlash())) {
                const flashEffect = document.getElementById('flashEffect');
                flashEffect.classList.add('active');
                setTimeout(() => flashEffect.classList.remove('active'), 300);
            }
            
            // Capture photo (simulated)
            const canvas = document.createElement('canvas');
            const video = document.getElementById('cameraPreview');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            // Convert to blob and save (simulated)
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                console.log('Photo captured:', url);
                
                // Update gallery thumbnail
                const galleryBtn = document.querySelector('.gallery-thumbnail');
                galleryBtn.innerHTML = `<img src="${url}" alt="Last photo">`;
                
                // Show success feedback
                showCaptureSuccess();
            }, 'image/jpeg', 0.9);
        }
        
        function toggleRecording() {
            isRecording = !isRecording;
            const shutterButton = document.querySelector('.shutter-button');
            
            if (isRecording) {
                shutterButton.style.background = '#dc2626';
                shutterButton.title = 'Stop Recording';
                // Add recording indicator
                shutterButton.style.animation = 'pulse 1s infinite';
            } else {
                shutterButton.style.background = '#ef4444';
                shutterButton.title = 'Start Recording';
                shutterButton.style.animation = 'none';
            }
        }
        
        function startTimer() {
            timerActive = true;
            let countdown = timerDuration;
            const indicator = document.getElementById('timerIndicator');
            
            indicator.textContent = countdown;
            indicator.classList.add('active');
            
            const timer = setInterval(() => {
                countdown--;
                indicator.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    indicator.classList.remove('active');
                    timerActive = false;
                    takePhoto();
                }
            }, 1000);
        }
        
        function shouldUseFlash() {
            // Simple light detection simulation
            return Math.random() < 0.3; // 30% chance to use flash in auto mode
        }
        
        function showCaptureSuccess() {
            // Brief visual feedback
            const preview = document.getElementById('cameraPreview');
            preview.style.filter = 'brightness(1.2)';
            setTimeout(() => {
                preview.style.filter = 'brightness(1)';
            }, 200);
        }
        
        // Gallery
        function openGallery() {
            alert('Gallery feature would open here with all captured photos and videos!');
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initCamera();
            updateFlashIcon();
            updateTimerIcon();
            updateGrid();
            setAspectRatio('full');
            
            // Handle orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    setAspectRatio(aspectRatio);
                }, 500);
            });
            
            // Prevent default touch behaviors
            document.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, { passive: false });
        });
        
        // Handle visibility change
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            } else if (!document.hidden) {
                initCamera();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9842fbcb433a57f0',t:'MTc1ODcyNDI2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
