<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Photo Camera</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;padding:10px}
    video{width:100%;max-width:600px;border-radius:10px;background:#000}
    .controls{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    select,button{padding:8px 12px;border-radius:6px;border:none;font-size:14px}
    button.capture{background:#0af;color:#000;font-weight:bold}
    .overlay{position:relative;display:inline-block}
    .grid{position:absolute;inset:0;pointer-events:none;display:none}
    .grid.show{display:block}
    .grid svg{width:100%;height:100%}
    .flash{position:absolute;inset:0;background:#fff;opacity:0;transition:opacity .15s}
    #preview{margin-top:15px;max-width:100%;border-radius:8px;display:none}
  </style>
</head>
<body>
  <h2>Simple Photo Camera</h2>

  <div class="overlay">
    <video id="video" autoplay playsinline></video>
    <div class="grid" id="grid">
      <svg viewBox="0 0 100 100">
        <g stroke="rgba(255,255,255,0.5)" stroke-width="0.5">
          <line x1="33.3" y1="0" x2="33.3" y2="100"/>
          <line x1="66.6" y1="0" x2="66.6" y2="100"/>
          <line x1="0" y1="33.3" x2="100" y2="33.3"/>
          <line x1="0" y1="66.6" x2="100" y2="66.6"/>
        </g>
      </svg>
    </div>
    <div class="flash" id="flash"></div>
  </div>

  <div class="controls">
    <label>Camera:
      <select id="facing">
        <option value="environment">Rear</option>
        <option value="user">Front</option>
      </select>
    </label>
    <label>Aspect:
      <select id="ratio">
        <option value="full">Auto</option>
        <option value="1:1">1:1</option>
        <option value="4:3">4:3</option>
        <option value="16:9">16:9</option>
      </select>
    </label>
    <label>Timer:
      <select id="timer">
        <option value="0">Off</option>
        <option value="3">3s</option>
        <option value="5">5s</option>
      </select>
    </label>
    <label><input type="checkbox" id="gridToggle"> Grid</label>
    <label><input type="checkbox" id="flashToggle"> Flash</label>
    <button class="capture" id="capture">ðŸ“· Capture</button>
  </div>

  <img id="preview" alt="Captured photo preview"/>
  <button id="download" style="display:none">Download</button>

  <script>
    const video = document.getElementById('video');
    const facing = document.getElementById('facing');
    const ratio = document.getElementById('ratio');
    const timerSel = document.getElementById('timer');
    const gridToggle = document.getElementById('gridToggle');
    const flashToggle = document.getElementById('flashToggle');
    const grid = document.getElementById('grid');
    const flash = document.getElementById('flash');
    const captureBtn = document.getElementById('capture');
    const preview = document.getElementById('preview');
    const downloadBtn = document.getElementById('download');
    let stream, lastBlob;

    async function startCamera(){
      if(stream) stream.getTracks().forEach(t=>t.stop());
      stream = await navigator.mediaDevices.getUserMedia({
        video:{facingMode:facing.value}
      });
      video.srcObject = stream;
    }

    async function takePhoto(){
      const delay = parseInt(timerSel.value,10);
      if(delay>0){
        setTimeout(doCapture, delay*1000);
      } else doCapture();
    }

    function doCapture(){
      if(flashToggle.checked){
        flash.style.opacity=1;
        setTimeout(()=>flash.style.opacity=0,150);
      }
      const vw=video.videoWidth, vh=video.videoHeight;
      const [rw,rh] = ratio.value==="full"? [vw,vh]: ratio.value.split(":").map(Number);
      let tw=vw, th=vh;
      if(ratio.value!=="full"){
        if(vw/vh>rw/rh){ th=vh; tw=Math.round(vh*rw/rh);}
        else{ tw=vw; th=Math.round(vw*rh/rw);}
      }
      const sx=(vw-tw)/2, sy=(vh-th)/2;
      const canvas=document.createElement('canvas');
      canvas.width=tw; canvas.height=th;
      canvas.getContext('2d').drawImage(video,sx,sy,tw,th,0,0,tw,th);
      canvas.toBlob(b=>{
        lastBlob=b;
        preview.src=URL.createObjectURL(b);
        preview.style.display="block";
        downloadBtn.style.display="inline-block";
      },"image/jpeg",0.9);
    }

    captureBtn.onclick=takePhoto;
    downloadBtn.onclick=()=> {
      const a=document.createElement('a');
      a.href=URL.createObjectURL(lastBlob);
      a.download="photo.jpg";
      a.click();
    };
    facing.onchange=startCamera;
    gridToggle.onchange=()=>grid.classList.toggle("show",gridToggle.checked);
    startCamera();
  </script>
</body>
</html>
